(function(){"use strict";var t={7172:function(t,s,e){var i=e(9242),r=e(3396);function n(t,s,e,i,n,a){const c=(0,r.up)("PlayGround");return(0,r.wg)(),(0,r.j4)(c)}const a={class:"playground"};function c(t,s,e,i,n,c){const h=(0,r.up)("ScoreBoard"),l=(0,r.up)("GameMap");return(0,r.wg)(),(0,r.iD)("div",a,[(0,r.Wm)(h),(0,r.Wm)(l)])}var h=e(7139);const l=t=>((0,r.dD)("data-v-705167ac"),t=t(),(0,r.Cn)(),t),o={class:"score-board"},p={class:"apple"},u=l((()=>(0,r._)("img",{src:"https://s1.328888.xyz/2022/08/05/jZF9N.png",alt:""},null,-1))),d={class:"cup"},f=l((()=>(0,r._)("img",{src:"https://s1.328888.xyz/2022/08/05/jZDF5.png",alt:""},null,-1)));function m(t,s,e,i,n,a){return(0,r.wg)(),(0,r.iD)("div",o,[(0,r._)("div",p,[u,(0,r._)("div",null,(0,h.zw)(t.$store.state.score),1)]),(0,r._)("div",d,[f,(0,r._)("div",null,(0,h.zw)(t.$store.state.record),1)])])}var g={name:"ScoreBoard"},v=e(89);const y=(0,v.Z)(g,[["render",m],["__scopeId","data-v-705167ac"]]);var x=y;const _={class:"gamemap",ref:"div"},w={ref:"canvas",tabindex:"0"},b={key:0,class:"operation"};function k(t,s,e,i,n,a){return(0,r.wg)(),(0,r.iD)("div",_,[(0,r._)("canvas",w,null,512),t.$store.state.restart?((0,r.wg)(),(0,r.iD)("div",b,[(0,r._)("button",{onClick:s[0]||(s[0]=(...s)=>t.restart&&t.restart(...s))},"开始游戏")])):(0,r.kq)("",!0)],512)}var j=e(4870);const M=[];class D{constructor(){M.push(this),this.timedelta=0,this.has_called_start=!1}start(){}update(){}on_destroy(){}destroy(){this.on_destroy();for(let t in M){const s=M[t];if(s===this){M.splice(t,1);break}}}}let A;const R=t=>{for(let s of M)s.has_called_start?(s.timedelta=t-A,s.update()):(s.start(),s.has_called_start=!0);A=t,requestAnimationFrame(R)};requestAnimationFrame(R);class L{constructor(t,s){this.i=t,this.j=s,this.x=t+.5,this.y=s+.5}}class O extends D{constructor(t,s){super(),this.ctx=t,this.gamemap=s,this.cells=[],this.color="#fe4bb8",this.dirs=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}],this.direction=2,this.eps=.1,this.speed=6,this.apple_cell=new L(-1,-1),this.apple_img=new Image,this.apple_img.src="https://s3.bmp.ovh/imgs/2022/08/17/ff681ab0e782aa0a.png",this.eating=!1,this.tail_cell=null}start(){this.cells.push(new L(4,7));for(let t=4;t>=1;t--)this.cells.push(new L(t,7));this.put_an_apple()}put_an_apple(){const t=new Set;for(let e=0;e<17;e++)for(let s=0;s<15;s++)t.add(`${e}-${s}`);for(let e of this.cells)t.delete(`${e.i}-${e.j}`);const s=Array.from(t);if(0===s.length)this.gamemap.win();else{let[t,e]=s[Math.floor(Math.random()*s.length)].split("-");t=parseInt(t),e=parseInt(e),this.apple_cell=new L(t,e)}}get_direction(t,s){return Math.abs(t.x-s.x)<this.eps&&Math.abs(t.y-s.y)<this.eps?-1:Math.abs(t.x-s.x)<this.eps?s.y<t.y?0:2:s.x>t.x?1:3}check_die(){const t=this.cells[0];if(t.i<0||t.i>=17||t.j<0||t.j>=15)return!0;for(let s=2;s<this.cells.length;s++)if(t.i===this.cells[s].i&&t.j===this.cells[s].j)return!0;return!1}update_body(){const t=this.cells.length-1,s=this.get_direction(this.cells[t],this.cells[t-1]);if(s>=0){const e=this.speed*this.timedelta/1e3;this.cells[t].x+=this.dirs[s].x*e,this.cells[t].y+=this.dirs[s].y*e,this.cells[0].x+=this.dirs[this.direction].x*e,this.cells[0].y+=this.dirs[this.direction].y*e}else{const s=[],e=this.cells[1].i+this.dirs[this.direction].x,i=this.cells[1].j+this.dirs[this.direction].y;s.push(new L(e,i)),s.push(new L(e,i));for(let n=1;n<t;n++)s.push(this.cells[n]);this.cells=s,this.eating&&(this.cells.push(this.tail_cell),this.eating=!1,this.tail_cell=null);const r=this.gamemap.directions;while(r.length>0&&(r[0]===this.direction||r[0]===(2^this.direction)))r.splice(0,1);if(r.length>0&&(this.direction=r[0],r.splice(0,1)),this.check_die()&&this.gamemap.lose(),e===this.apple_cell.i&&i===this.apple_cell.j){this.eating=!0;const t=this.cells[this.cells.length-1];this.tail_cell=new L(t.i,t.j),this.put_an_apple();const s=this.gamemap.store.state.score+1;this.gamemap.store.commit("updateScore",s),this.gamemap.store.commit("updateRecord",s)}}}update(){"playing"===this.gamemap.status&&this.update_body(),this.render()}render(){const t=this.gamemap.L;this.eating&&this.cells.push(this.tail_cell),this.ctx.drawImage(this.apple_img,this.apple_cell.i*t,this.apple_cell.j*t,t,t),this.ctx.fillStyle=this.color;for(let s of this.cells)this.ctx.beginPath(),this.ctx.arc(s.x*t,s.y*t,t/2*.8,0,2*Math.PI),this.ctx.fill();for(let s=1;s<this.cells.length;s++){const e=this.cells[s-1],i=this.cells[s];Math.abs(e.x-i.x)<this.eps&&Math.abs(e.y-i.y)<this.eps||(Math.abs(e.x-i.x)<this.eps?this.ctx.fillRect((e.x-.5+.1)*t,Math.min(e.y,i.y)*t,.8*t,Math.abs(e.y-i.y)*t):this.ctx.fillRect(Math.min(e.x,i.x)*t,(e.y-.5+.1)*t,Math.abs(e.x-i.x)*t,.8*t))}this.eating&&this.cells.pop()}}class I extends D{constructor(t,s,e){super(),this.ctx=t,this.parent=s,this.store=e,this.L=0,this.snake=new O(this.ctx,this),this.directions=[],this.status="waiting"}start(){this.ctx.canvas.focus(),this.ctx.canvas.addEventListener("keydown",(t=>{if(this.store.state.restart)return!1;"w"===t.key||"ArrowUp"===t.key?(this.directions.push(0),t.preventDefault()):"d"===t.key||"ArrowRight"==t.key?(this.directions.push(1),t.preventDefault()):"s"===t.key||"ArrowDown"===t.key?(this.directions.push(2),t.preventDefault()):"a"!==t.key&&"ArrowLeft"!==t.key||(this.directions.push(3),t.preventDefault());let s=this.directions.length;s>1&&this.directions[s-1]===this.directions[s-2]&&this.directions.pop();while(this.directions.length>2)this.directions.splice(0,1);"waiting"===this.status&&this.directions.length&&3!==this.directions[0]&&(this.status="playing",this.snake.direction=this.directions[0])}))}update_size(){this.L=Math.min(this.parent.clientWidth/17,this.parent.clientHeight/15),this.ctx.canvas.width=17*this.L,this.ctx.canvas.height=15*this.L}win(){this.snake.color="#1e1e1e",this.status="win",this.store.commit("updateRestart",!0)}lose(){this.snake.color="#1e1e1e",this.status="lose",this.store.commit("updateRestart",!0)}restart(){this.store.state.score=0,this.status="waiting",this.snake.destroy(),this.snake=new O(this.ctx,this),this.store.commit("updateRestart",!1),this.ctx.canvas.focus()}update(){this.update_size(),this.render()}render(){let t="#AAD751",s="#A2D149";for(let e=0;e<17;e++)for(let i=0;i<15;i++)this.ctx.fillStyle=(e+i)%2==0?t:s,this.ctx.fillRect(e*this.L,i*this.L,this.L,this.L)}}var S=e(65),P={name:"GameMap",components:{},setup:()=>{let t=(0,j.iH)(null),s=(0,j.iH)(null);const e=(0,S.oR)();let i=null;(0,r.bv)((()=>{i=new I(s.value.getContext("2d"),t.value,e)}));const n=()=>{i.restart()};return{div:t,canvas:s,restart:n}}};const $=(0,v.Z)(P,[["render",k],["__scopeId","data-v-a05382d6"]]);var z=$,G={name:"PlayGround",components:{ScoreBoard:x,GameMap:z}};const Z=(0,v.Z)(G,[["render",c],["__scopeId","data-v-5ed03a5e"]]);var C=Z,F={name:"App",components:{PlayGround:C}};const q=(0,v.Z)(F,[["render",n]]);var B=q,H=(0,S.MT)({state:{score:0,record:0,restart:!0,access:"",refresh:""},getters:{},mutations:{updateScore:(t,s)=>{t.score=s},updateRecord:(t,s)=>{t.record<s&&(t.record=s)},updateRestart:(t,s)=>{t.restart=s},updateAccess:(t,s)=>{t.access=s},updateRefresh:(t,s)=>{t.refresh=s}},actions:{},modules:{}});(0,i.ri)(B).use(H).mount("#app")}},s={};function e(i){var r=s[i];if(void 0!==r)return r.exports;var n=s[i]={exports:{}};return t[i](n,n.exports,e),n.exports}e.m=t,function(){var t=[];e.O=function(s,i,r,n){if(!i){var a=1/0;for(o=0;o<t.length;o++){i=t[o][0],r=t[o][1],n=t[o][2];for(var c=!0,h=0;h<i.length;h++)(!1&n||a>=n)&&Object.keys(e.O).every((function(t){return e.O[t](i[h])}))?i.splice(h--,1):(c=!1,n<a&&(a=n));if(c){t.splice(o--,1);var l=r();void 0!==l&&(s=l)}}return s}n=n||0;for(var o=t.length;o>0&&t[o-1][2]>n;o--)t[o]=t[o-1];t[o]=[i,r,n]}}(),function(){e.n=function(t){var s=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(s,{a:s}),s}}(),function(){e.d=function(t,s){for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})}}(),function(){e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)}}(),function(){var t={143:0};e.O.j=function(s){return 0===t[s]};var s=function(s,i){var r,n,a=i[0],c=i[1],h=i[2],l=0;if(a.some((function(s){return 0!==t[s]}))){for(r in c)e.o(c,r)&&(e.m[r]=c[r]);if(h)var o=h(e)}for(s&&s(i);l<a.length;l++)n=a[l],e.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return e.O(o)},i=self["webpackChunktest1"]=self["webpackChunktest1"]||[];i.forEach(s.bind(null,0)),i.push=s.bind(null,i.push.bind(i))}();var i=e.O(void 0,[998],(function(){return e(7172)}));i=e.O(i)})();
//# sourceMappingURL=app.c6fbb81a.js.map